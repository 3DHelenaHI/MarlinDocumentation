<!DOCTYPE html>
<!--
  Marlin Firmware Documentation
  Copyright (C) 2016 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.


  Generated by Jekyll v3.0.3
  Website version: 0.0.4
--><html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- head -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v1.3.3 -->
<title>Coding Standards - Marlin 3D Printer Firmware</title>
<meta property="og:title" content="Coding Standards">
<meta name="description" content="Overview if formatting guidelines and coding standards to be used when contributing code to Marlin">
<meta property="og:description" content="Overview if formatting guidelines and coding standards to be used when contributing code to Marlin">
<link rel="canonical" href="http://marlinfw.org/articles/development/coding-standards.html">
<meta property="og:url" content=" http://marlinfw.org/articles/development/coding-standards.html">
<meta property="og:site_name" content="Marlin 3D Printer Firmware">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-06-17T20:26:56+01:00">
<link rel="next" href="http://marlinfw.org/articles/development/contributing.html" title="Contributing">
<link rel="prev" href="http://marlinfw.org/articles/development/changelog.html" title="Changelog">
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Coding Standards",
    "datePublished": "2016-06-17T20:26:56+01:00",
    "description": "Overview if formatting guidelines and coding standards to be used when contributing code to Marlin",
    "logo": " http://marlinfw.org/assets/images/logo/marlin/small.png",
    "url": " http://marlinfw.org/articles/development/coding-standards.html"
  }
</script>
<!-- End Jekyll SEO tag -->

    <link rel="icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="/assets/stylesheets/bootstrap.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="/assets/javascript/head.min.js"></script>
    <script type="text/javascript"><!--
        /**
         * As Github pages do not support https for custom domains
         * this is the current best workaround for #18.
         */
        var domains  = ['www.marlinfw.org', 'marlinfw.org', 'localhost', '127.0.0.1' ];
        var pathname = location.pathname.replace(/^\/MarlinDocumentation/, '')
        if (domains.indexOf(window.location.hostname) == -1)
            window.top.location.href = 'http://www.marlinfw.org' + pathname;

        /**
         * Improves page loading speed by loading javascript in parallel
         * with the main page.
         */
        head.load(
            "/assets/stylesheets/font-awesome.min.css",
            "/assets/stylesheets/syntax.css",
            "/assets/stylesheets/custom.css",

            "/assets/javascript/jquery-2.2.1.min.js",
            "/assets/javascript/jquery-ui.min.js",
            "/assets/javascript/jquery.tocify.min.js",
            "/assets/javascript/bootstrap.min.js",
            "/assets/javascript/holder.min.js",
            "/assets/javascript/custom.js",
            "//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"
        );
    --></script>

    <script type="text/javascript">
      window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":"","theme":"dark-bottom"};
    </script>
    <!-- /head -->

  </head>
  <body role="document">
        <!-- navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="/" class="navbar-brand">
            <img src="/assets/images/logo/marlin/text.png" alt="Marlin" height="25">
          </a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-getting-started">Getting Started <span class="caret"></span></a>
              <ul class="dropdown-menu" aria-labelledby="getting-started">
                <li><a href="/articles/getting-started/overview.html">Introduction</a></li>
                <li class="divider">
                </li>
<li><a href="#"><del>How to get</del></a></li>
                <li><a href="/articles/getting-started/configure.html">How to configure</a></li>
                <li><a href="/articles/getting-started/install.html">How to flash your board</a></li>
                <li class="divider">
                </li>
<li><a href="/articles/development/reporting-bugs.html">Reporting bugs</a></li>
              </ul>
            </li>

            <li>
              <a href="#"><del>Download</del></a>
            </li>

            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-documentation">Documentation <span class="caret"></span></a>
              <ul class="dropdown-menu" aria-labelledby="documentation">
                <li><a href="/articles/development/changelog.html">Changelog</a></li>
                <li class="divider">
                </li>
<li><a href="#"><del>Current stable release</del></a></li>
                <li><a href="#"><del>Current development release</del></a></li>
                <li class="divider">
                </li>
<li><a href="/meta/needs-review.html">Documentation needing review</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="navbar-development">Development <span class="caret"></span></a>
              <ul class="dropdown-menu" aria-labelledby="development">
                <li><a href="/articles/development/contributing.html">Contributing</a></li>
                <li><a href="/articles/development/coding-standards.html">Coding standards</a></li>
                <li class="divider">
                </li>
<li><a href="https://github.com/MarlinFirmware/Marlin/issues">Bugtracker</a></li>
                <li><a href="/articles/development/reporting-bugs.html">Reporting bugs</a></li>
                <li class="divider">
                </li>
<li><a href="https://github.com/MarlinFirmware/Marlin/">Source code</a></li>
                <li><a href="https://github.com/MarlinFirmware/MarlinDev/">Development source code</a></li>
              </ul>
            </li>
          </ul>

          
          <ul class="nav navbar-nav navbar-right visible-lg-block">
            <li><a href="https://github.com/MarlinFirmware/MarlinDocumentation/edit/master/_articles/development/coding-standards.md" data-proofer-ignore>
              <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
              <span class="">Improve this page</span></a></li>
          </ul>
          
        </div>
      </div>
    </nav>
    <!-- /navbar -->

    

    <!-- content -->
    <div class="container-fluid" role="main">
      <div class="row">
        <div class="col-md-3 col-lg-2 visible-lg-block visible-md-block custom-fixed-sidebar">
          <div id="toc"></div>
        </div>
        <div class="col-md-9 col-lg-10 col-md-offset-3 col-lg-offset-2">
          <div class="row">
            <div class="col-md-6">
              <h1>Coding Standards</h1>
            </div>
            <div class="col-md-6">
              <p class="text-right visible-lg-block hidden-print small">
                
                
                  
                    <a href="https://github.com/MarlinFirmware" data-toggle="tooltip" data-placement="bottom" title="Visit MarlinFirmware's profile on Github">
                    <img class="avatar avatar-small" src="https://avatars0.githubusercontent.com/MarlinFirmware?v=3&amp;s=30" alt="MarlinFirmware" srcset="https://avatars0.githubusercontent.com/MarlinFirmware?v=3&amp;s=30 1x, https://avatars0.githubusercontent.com/MarlinFirmware?v=3&amp;s=60 2x, https://avatars0.githubusercontent.com/MarlinFirmware?v=3&amp;s=90 3x, https://avatars0.githubusercontent.com/MarlinFirmware?v=3&amp;s=120 4x" width="30" height="30" data-proofer-ignore="true"></a>
                  
                
              </p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 visible-lg-block hidden-print">
              
                
          <!-- breadcrumbs -->
          <ol class="breadcrumb">
            <li><a href="/"><i class="glyphicon glyphicon-home"></i></a></li>
            <li><a href="/articles/">Articles</a></li>
<li><a href="/articles/development/">Development</a></li>
            <li class="active">Coding Standards</li>
          </ol>
          <!-- /breadcrumbs -->

              
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <p>Please follow these formatting guidelines and coding standards when contributing code to Marlin. Pull requests that don’t follow good coding standards may be postponed for cleanup.</p>

<h2 id="coding-style">Coding Style</h2>

<h3 id="indentation">Indentation</h3>

<p>Indentation is important for readability and maintainability of code, and provides guidance for naïve code editors (e.g., TextMate, Sublime, et. al.) to properly fold code blocks by level.</p>

<ul>
  <li>2 spaces. Don’t use tabs at all.</li>
  <li>All blocks indented, including <code class="highlighter-rouge">#if</code> blocks and other non-brace compiler blocks</li>
</ul>

<!-- -->

<div class="highlighter-rouge">
<pre class="highlight"><code>void myFunction() {
  if (myCondition == 0) {
    #ifdef PETER_PARKER
      slingWeb(100);
    #else
      findPhoneBooth();
    #endif
  }
}
</code></pre>
</div>

<h3 id="bracket-style">Bracket-style</h3>

<p>We’ve chosen a bracket (i.e., <em>brace</em>) style that shows the most code lines on screen, and which causes folded code blocks to appear at the end of the line where they begin. If vertical spacing makes code more readable, add a blank line rather than using a different bracket style.</p>

<ul>
  <li>“One True Bracket” Style – “1TBS” – to rule them all</li>
  <li>Almost all opening braces at the end of lines, including declarations:</li>
</ul>

<!-- -->

<div class="highlighter-rouge">
<pre class="highlight"><code>if (...) {
  ...
}
else {
  ...
}
</code></pre>
</div>

<ul>
  <li>Closing braces should always align with the starting column of the opening line</li>
</ul>

<h3 id="spacing">Spacing</h3>

<ul>
  <li>One space between keywords and their conditions:
<code class="highlighter-rouge">if</code> <code class="highlighter-rouge">(…)</code>, <code class="highlighter-rouge">while</code> <code class="highlighter-rouge">(…)</code>, <code class="highlighter-rouge">do</code> <code class="highlighter-rouge"><span class="p">{</span><span class="err">…</span><span class="p">}</span></code> <code class="highlighter-rouge">while(…)</code> etc.</li>
  <li>No space between functions and their arguments:
<code class="highlighter-rouge">myFunction(…);</code>
</li>
  <li>Spaces between operators, most of the time:
<code class="highlighter-rouge">myVar</code> <code class="highlighter-rouge">=</code> <code class="highlighter-rouge">aVar</code> <code class="highlighter-rouge">+</code> <code class="highlighter-rouge">bVar</code> <code class="highlighter-rouge">*</code> <code class="highlighter-rouge">cVar;</code>
<code class="highlighter-rouge">myVal</code> <code class="highlighter-rouge">=</code> <code class="highlighter-rouge">(a*b</code> <code class="highlighter-rouge">+</code> <code class="highlighter-rouge">b*c);</code> <code class="highlighter-rouge">//</code> <code class="highlighter-rouge">grouping</code>
</li>
</ul>

<h3 id="comments">Comments</h3>

<ul>
  <li>Doxygen-style headings (documenting in .h files), C++ single-line style // for under 3 lines</li>
  <li>Multi-line use asterisks in the second column</li>
</ul>

<h2 id="names-and-symbols">Names and Symbols</h2>

<h3 id="capitalization">Capitalization</h3>

<ul>
  <li>
<code class="highlighter-rouge">your_function_name(int</code> <code class="highlighter-rouge">in_integer,</code> <code class="highlighter-rouge">float</code> <code class="highlighter-rouge">in_float=0.0)</code>
</li>
  <li><code class="highlighter-rouge">MyClass</code></li>
  <li><code class="highlighter-rouge">ClassMethod</code></li>
  <li><code class="highlighter-rouge">classData</code></li>
  <li><code class="highlighter-rouge">local_variable</code></li>
  <li><code class="highlighter-rouge">global_variable</code></li>
  <li>
<code class="highlighter-rouge">MACRO_NAME</code> – anything created with <code class="highlighter-rouge">#define</code>
</li>
  <li><code class="highlighter-rouge">EnumeratedType</code></li>
</ul>

<h3 id="filenames">Filenames</h3>

<ul>
  <li>use <code class="highlighter-rouge">.cpp</code> for C++ sources</li>
  <li>use <code class="highlighter-rouge">.c</code> for C only sources</li>
  <li>use <code class="highlighter-rouge">.h</code> for headers of all types</li>
</ul>

<h3 id="directories">Directories</h3>

<ul>
  <li>Lowercase names.</li>
  <li>Note that Arduino cannot (easily) compile code in a sketch subfolder</li>
</ul>

<h3 id="libraries">Libraries</h3>

<p>Whenever possible use functions supplied by avr-libc or Arduino bundled libraries. Any libraries required to compile Marlin should be included in the package so that they are guaranteed to be compatible versions.</p>

<h2 id="extended-language-features">Extended Language Features</h2>

<p>Marlin is written in C/C++ and must be able to compile with the supplied Makefile and an up-to-date version of Arduino. Backward-compatibility to earlier versions of Arduino is not required, but we can deal with this on an issue-to-issue basis.</p>

<h3 id="primitive-types">Primitive Types</h3>

<ul>
  <li>On AVR both <code class="highlighter-rouge">int</code> and <code class="highlighter-rouge">short</code> are 16-bits, and <code class="highlighter-rouge">long</code> is 32 bits.</li>
</ul>

<h3 id="memory-usage">Memory Usage</h3>

<ul>
  <li>DO NOT use dynamic memory allocations such as <code class="highlighter-rouge">malloc()</code>, <code class="highlighter-rouge">free()</code>, <code class="highlighter-rouge">new</code>, <code class="highlighter-rouge">delete</code>
</li>
  <li><em>(Some exceptions may be considered, with caveats!)</em></li>
</ul>

<h3 id="no-extended-features">No Extended Features</h3>

<ul>
  <li>DO NOT use extended C++ features like:</li>
</ul>

<p><code class="highlighter-rouge"> * Exceptions (throw / catch)</code>
` * Virtual functions / classes<code class="highlighter-rouge">
</code> * Templates<code class="highlighter-rouge">
</code> * Standard Template Library (STL)`</p>

<h3 id="avoid-expensive-code">Avoid Expensive Code</h3>

<ul>
  <li>
<code class="highlighter-rouge">millis()</code> can be expensive so put it in a <code class="highlighter-rouge">uint32_t</code> if you need it more than once.</li>
  <li>Pre-calculate if possible instead of calculating on the fly</li>
</ul>

<h2 id="marlin-specific-conventions">Marlin-specific Conventions</h2>

<h3 id="preprocessor-directives">Preprocessor directives</h3>

<ul>
  <li>Use <code class="highlighter-rouge">#define</code> instead of <code class="highlighter-rouge">const</code> for configurable values (for now)</li>
  <li>Don’t use <code class="highlighter-rouge">#if</code> / <code class="highlighter-rouge">#endif</code> for commenting-out unused, old or broken code. We have a git repository! If it’s obsolete, delete it.</li>
  <li>Use <code class="highlighter-rouge">#if</code> <code class="highlighter-rouge">ENABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile enabled features. (Using these macros allows features to be set externally.)</li>
  <li>Use <code class="highlighter-rouge">#if</code> <code class="highlighter-rouge">DISABLED(FEATURE_NAME)</code> / <code class="highlighter-rouge">#endif</code> to compile disabled features. (Using these macros allows features to be set externally.)</li>
  <li>Use <code class="highlighter-rouge">#define</code> macros to avoid repeating boilerplate code.
Consider both readability and maintainability.</li>
</ul>

<h3 id="adding-a-new-feature">Adding a New Feature</h3>

<p>Since Marlin is an Arduino firmware and not a desktop application, much care has been taken to keep code size at a minimum, and to avoid using any features that may overtax the hardware, including demanding math operations. New features should try to conserve the limited resources available and allocate a fixed amount of memory (apart from <code class="highlighter-rouge">auto</code> variables) to do their work.</p>

<ul>
  <li>
<code class="highlighter-rouge">#define</code> is used liberally, especially for configuration values</li>
  <li>Use <code class="highlighter-rouge">#define</code> <code class="highlighter-rouge">MYFEATURE</code> for feature switches.</li>
  <li>Feature settings have some flexibility, and can have values.</li>
  <li>Test features with <code class="highlighter-rouge">#if</code> <code class="highlighter-rouge">ENABLED(MYFEATURE)</code> / <code class="highlighter-rouge">#if</code> <code class="highlighter-rouge">DISABLED(MYFEATURE)</code>. (Using these macros allows features to be set externally.)</li>
  <li>Indent the code between <code class="highlighter-rouge">#if…</code> and <code class="highlighter-rouge">#endif</code> for editors that only have naive code-folding.</li>
  <li>Add a comment: <code class="highlighter-rouge">#endif</code> <code class="highlighter-rouge">//</code> <code class="highlighter-rouge">MYFEATURE</code> — Only if the <code class="highlighter-rouge">#endif</code> is <em>far away</em>!</li>
</ul>

<h4 id="new-feature-example">New Feature Example</h4>

<p><strong>In Configuration.h:</strong></p>

<div class="highlighter-rouge">
<pre class="highlight"><code>// Enable this to make something new happen
#define MYFEATURE
#if ENABLED(MYFEATURE)
  #define MYFEATURE_SETTING 12.5
  #undef OVERRIDDEN_FEATURE // This won't be needed with MYFEATURE
#endif
</code></pre>
</div>

<p><strong>In SanityCheck.h:</strong></p>

<div class="highlighter-rouge">
<pre class="highlight"><code>/**
 * My feature
 */
#if ENABLED(MYFEATURE) &amp;&amp; ENABLED(INCOMPAT_FEATURE)
  #error MYFEATURE is not compatible with INCOMPAT_FEATURE
#endif
</code></pre>
</div>

<p><strong>In Conditionals.h:</strong></p>

<div class="highlighter-rouge">
<pre class="highlight"><code>/**
 * My feature
 */
#if ENABLED(MYFEATURE)
  #undef OVERRIDDEN_FEATURE // This feature is disabled by MYFEATURE
  #undef OVERRIDDEN_SETTING // This setting will always be 1234 with MYFEATURE
  #define OVERRIDDEN_SETTING 1234
#endif
</code></pre>
</div>

<p><strong>In Marlin_main.cpp, for example:</strong></p>

<div class="highlighter-rouge">
<pre class="highlight"><code>// My Feature, when Your Feature is disabled
#if ENABLED(MYFEATURE) &amp;&amp; DISABLED(YOURFEATURE)
  my_feature_function(); // Run my feature, possible an inline function taking refs
  #if ENABLED(HISFEATURE)
    ...
    call_something();
    ...
  #else // !HISFEATURE
    ...
    call_something_else();
    ...
  #endif // !HISFEATURE
#endif // MYFEATURE
</code></pre>
</div>

<h2 id="useful-links">Useful links</h2>

<ul>
  <li>[Atmel AVR4027: Tips and Tricks to Optimize Your C Code for 8-bit AVR Microcontrollers](http://www.atmel.com/images/doc8453.pdf)</li>
</ul>

            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /content -->

    
    <!-- footer -->
    <div class="container-fluid">
      <footer>
        <div class="row">
          <div class="col-md-9 col-lg-10 col-md-offset-3 col-lg-offset-2">
            <hr>
            <ul class="list-unstyled">
              <li class="pull-right"><a href="#top" data-proofer-ignore>Back to top <i class="fa fa-level-up" aria-hidden="true"></i></a></li>
              <li>Brought to you with <i class="fa fa-heart text-danger" aria-hidden="true"></i> lack of
                <i class="fa fa-bed" aria-hidden="true"></i> and lots of
                <i class="fa fa-coffee" aria-hidden="true"></i>.
              </li>
<li>The contents of this website are © 2016 under the terms of the <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a> License.</li>
            </ul>
          </div>
<!-- /.col-lg-12 -->
        </div>
<!-- /.row -->
      </footer>
    </div>
<!-- /.container -->
    <!-- /footer -->

    <!-- analytics -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-76230130-1', {
        'cookieDomain': 'marlinfw.org',
        'siteSpeedSampleRate': 80
    });

    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>

<!-- /analytics -->

  </body>
</html>
